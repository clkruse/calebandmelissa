<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M&C - Favorite Places</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Caslon+Text:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        @font-face {
            font-family: 'Helvetica';
            src: url('fonts/HelveticaNeue.ttc') format('ttc');
            font-weight: normal;
            font-style: normal;
        }
        body, html {
            margin: 0;
            padding: 0;
            font-family: Helvetica, serif;
            box-sizing: border-box;
            height: 100%;
            overflow: hidden;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: calc(100% - 40px);
            display: flex;
        }
        h1, h2 {
            margin: 0;
        }
        .grid {
            display: flex;
            gap: 20px;
            height: 100%;
            width: 100%;
        }
        .locations {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .locations::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
        .card {
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            height: calc(50vh - 30px);
            margin-bottom: 20px;
        }
        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .card-title, .card-content {
            position: absolute;
            left: 0;
            right: 0;
            padding: 20px;
            transition: opacity 0.3s ease;
        }
        .card-title {
            top: 0;
            background-color: rgba(255, 255, 255, 0.8);
        }
        .card-title h2 {
            font-family: Helvetica, serif;
            font-weight: bold;
            font-size: 1.5em;
            color: #000;
            text-transform: uppercase;
        }
        .card-content {
            top: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            opacity: 0;
            font-family: 'Libre Caslon Text', serif;
        }
        .card-content h2 {
            color: #d97856;
            font-style: normal;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .card-content p {
            font-style: italic;
        }
        .map-container {
            flex: 1;
            position: relative;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            border-radius: 8px;
        }
        .get-directions {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            background-color: white;
            padding: 5px 10px;
            border-radius: 4px;
            text-decoration: none;
            color: #0078A8;
            font-weight: bold;
            font-size: 14px;
        }
        .region-card {
            background-color: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            height: calc(50vh - 30px);
            margin-bottom: 20px;
        }
        .region-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .region-card h2 {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            margin: 0;
            color: #333;
            font-family: Helvetica, serif;
            font-weight: bold;
            font-size: 1.5em;
            text-transform: uppercase;
        }
        
        /* Mobile styles */
        @media (max-width: 767px) {
            .container {
                padding: 0;
                height: 100%;
            }
            .grid {
                flex-direction: column;
                height: 100%;
                gap: 0;
            }
            .locations, .map-container {
                flex: none;
                height: 50%;
            }
            .locations {
                order: 2;
                padding: 20px;
            }
            .map-container {
                order: 1;
                margin: 20px;
            }
            #map {
                border-radius: 8px;
            }
            .card {
                height: calc(40vh - 30px);
            }
            .region-card {
                height: calc(40vh - 30px);
            }
            .card.active .card-title {
                opacity: 0;
            }
            .card.active .card-content {
                opacity: 1;
            }
        }
        
        /* Desktop styles */
        @media (min-width: 768px) {
            .card:hover .card-title {
                opacity: 0;
            }
            .card:hover .card-content {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="grid">
            <div class="locations">
                <!-- Cards will be dynamically inserted here -->
            </div>
            <div class="map-container">
                <div id="map"></div>
                <a href="#" class="get-directions" target="_blank">Get Directions</a>
            </div>
        </div>
    </div>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiY2xrcnVzZSIsImEiOiJjaXIxY2M2dGcwMnNiZnZtZzN0Znk3MXRuIn0.MyKHSjxjG-ZcI2BkRUSGJA';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/clkruse/ck5sl4yw4195e1iryj5sa28g8',
            center: [-122.5634, 37.8855],
            zoom: 11,
            scrollZoom: false // Disable scroll zoom
        });

        const locationsData = [
            {
                name: "San Francisco Airport",
                region: "SF",
                description: "One of two airports in the bay that provide easy access. SFO is about an hour and a half drive from The Lodge at Marconi.",
                coordinates: [37.61588661558195, -122.38792568845261]
            },
            {
                name: "Oakland Airport",
                region: "East Bay",
                description: "Confusingly the Oakland airport was recently renamed to \"San Francisco Bay Oakland Airport.\" OAK and SFO are equally good airports to visit for our wedding. OAK is about an hour and a half drive from The Lodge at Marconi.",
                coordinates: [37.71192750221407, -122.2112802196859]
            },
            {
                name: "Home",
                region: "East Bay",
                description: "We live in the Rockridge neighborhood between Oakland and Berkeley. The neighborhood has an abundance of good restaurants and coffee. Come by for a visit!",
                coordinates: [37.84712091925696, -122.25204220723741]
            },
            {
                name: "The Lodge at Marconi",
                region: "Point Reyes",
                description: "This is the site of our wedding! We can't wait to see you all there!",
                coordinates: [38.14518218154993, -122.8796370708087]
            },
            {
                name: "Side Street Kitchen",
                region: "Point Reyes",
                description: "This is a great spot to grab a meal after a day of exploring Point Reyes. They server hearty and wholesome meals. Caleb's all-time favorite is the bean cassoulet.",
                coordinates: [38.06853384289934, -122.80745321946566]
            },
            {
                name: "West Marin Culture Shop",
                region: "Point Reyes",
                description: "This grocery store / food hall is filled with tasty fermented foods. Great cheeses, sauerkraut, kombuchas, and more. Our favorite is the \"24 Carrot Gold\" sauerkraut.",
                coordinates: [38.06815142166285, -122.80715576145504]
            },
            {
                name: "Toby's Coffee Shop",
                region: "Point Reyes",
                description: "Don't let the location in a barn keep you away, Toby's is the best coffee spot in Point Reyes. Bovine Bakery gets a lot of attention, but stop by Toby's for a good coffee made with beans from Linea. Note: Toby's only takes cash.",
                coordinates: [38.06785989292327, -122.8053679013363]
            },
            {
                name: "Palace Market Ice Cream",
                region: "Point Reyes",
                description: "This grocery store serves the most delicious buffalo milk ice cream. Be sure and stop by for a cup at some point during your stay.",
                coordinates: [38.06834635036777, -122.80616703002337]
            },
            {
                name: "Point Reyes National Seashore",
                region: "Point Reyes",
                description: "Located on the opposite side of Tomales Bay from Marconi, you can't go wrong with any visits to this National Seashore. Some of our favorite spots are hiking to the end of the peninsula Tomales Point, visiting the famous Cypress Tree Tunnel, or spending some time at the many beaches (Limantour is a favorite). Keep an eye out for Tule Elk, an elk that is endemic to this small area.",
                coordinates: [38.05353507949709, -122.88675992051756]
            },
            {
                name: "Hook Fish",
                region: "Mill Valley",
                description: "This is one of our favorite places to stop near Mill Valley to grab a fish burrito. The spot is quintessentially Northern California. Caleb and Melissa went on their first date next door at The Junction, and came here with friends after getting engaged.",
                coordinates: [37.88195712913471, -122.52469656958857]
            },
            {
                name: "Muir Woods",
                region: "Mill Valley",
                description: "We've spent many hours running in the beautiful hills surrounding Muir Woods. This area is filled with majestic redwoods and fern forests. We got engaged just up the hill too! Note: To visit Muir Woods, you'll need to either get a reservation, or to follow this route.",
                coordinates: [37.892280862430276, -122.57159534078939]
            },
            {
                name: "Lands End",
                region: "SF",
                description: "This is one of the most beautiful places in San Francisco. If you walk along the path for a ways, you'll catch stunning views of the coast and of the Golden Gate Bridge.",
                coordinates: [37.7802594477183, -122.51161819858251]
            },
            {
                name: "Dipsea Trail",
                region: "Mill Valley",
                description: "Home of the oldest trail race in America (started in 1905), the Dipsea trail is a stunning 7.5-mile trip through redwood forests and open meadows to reach Stinson Beach. Start at Old Mill Park, and follow the signs up the stairs. The Dipsea is Caleb's favorite trail in the whole world--he's run the 14-mile out and back more than 30 times!",
                coordinates: [37.90535521935288, -122.55245509274286]
            }
            ];

const locationsContainer = document.querySelector('.locations');
const directionsLink = document.querySelector('.get-directions');
const markers = [];

// Sort locations by region
locationsData.sort((a, b) => a.region.localeCompare(b.region));

// Group locations by region
const groupedLocations = locationsData.reduce((acc, location) => {
    if (!acc[location.region]) {
        acc[location.region] = [];
    }
    acc[location.region].push(location);
    return acc;
}, {});

Object.entries(groupedLocations).forEach(([region, locations]) => {
    // Create region card
    const regionCard = document.createElement('div');
    regionCard.className = 'region-card';
    regionCard.innerHTML = `
        <img src="../img/${region}.jpg" alt="${region}">
        <h2>${region}</h2>
    `;
    locationsContainer.appendChild(regionCard);

    // Create location cards for this region
    locations.forEach((location, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <img src="../img/${location.name}.jpg" alt="${location.name}">
            <div class="card-title">
                <h2>${location.name.toUpperCase()}</h2>
            </div>
            <div class="card-content">
                <h2>${location.name}</h2>
                <p>${location.description}</p>
            </div>
        `;
        locationsContainer.appendChild(card);

        // Create a circle marker
        const el = document.createElement('div');
        el.className = 'marker';
        
        const marker = new mapboxgl.Marker({
            element: el,
            anchor: 'center'
        })
            .setLngLat(location.coordinates.reverse())
            .addTo(map);
        
        marker.getElement().addEventListener('click', () => {
            scrollToCard(card);
            flyToMarker(location.coordinates[0], location.coordinates[1]);
            updateDirectionsLink(location.coordinates[1], location.coordinates[0]);
        });

        markers.push({ marker, lat: location.coordinates[1], lng: location.coordinates[0] });

        card.addEventListener('click', function() {
            if (window.innerWidth <= 767) {
                this.classList.toggle('active');
            }
            flyToMarker(location.coordinates[0], location.coordinates[1]);
            updateDirectionsLink(location.coordinates[1], location.coordinates[0]);
        });
    });

    // Add click event to region card
    regionCard.addEventListener('click', () => {
        const regionBounds = new mapboxgl.LngLatBounds();
        locations.forEach(location => {
            regionBounds.extend(location.coordinates);
        });
        map.fitBounds(regionBounds, { padding: 50 });
    });
});

// Add a new layer for circle markers
map.on('load', function () {
    map.addSource('points', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': markers.map(({ lat, lng }) => ({
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [lng, lat]
                }
            }))
        }
    });

    map.addLayer({
        'id': 'points',
        'type': 'circle',
        'source': 'points',
        'paint': {
            'circle-radius': 5,
            'circle-color': '#AE060F',
            'circle-stroke-width': 2,
            'circle-stroke-color': '#fff'
        }
    });
});

function scrollToCard(card) {
    card.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function flyToMarker(lng, lat) {
    map.flyTo({
        center: [lng, lat],
        zoom: 14,
        duration: 1000
    });
}
function updateDirectionsLink(lat, lng) {
    directionsLink.href = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
}

// Fit map to show all markers
const bounds = new mapboxgl.LngLatBounds();
markers.forEach(({ marker }) => bounds.extend(marker.getLngLat()));
map.fitBounds(bounds, { padding: 50 });

// Initialize directions link
if (markers.length > 0) {
    updateDirectionsLink(markers[0].lat, markers[0].lng);
}
</script>
</body>
</html>